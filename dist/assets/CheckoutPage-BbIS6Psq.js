import{u as E,r as o,j as e,l as g,_ as A,a as T,t as k,x as S}from"./index-YJK9wbQ5.js";import{A as F,U as P,C as O}from"./UpdateAddressInput-lgFfc3B6.js";const $=({orderCartItem:p,onPlaceOrder:h})=>{const{user:n}=E(a=>a.userReducer),d=n._id,[i,c]=o.useState([]),[r,f]=o.useState(""),[x,t]=o.useState(),[m,j]=o.useState(0),[y,v]=o.useState(!0);o.useEffect(()=>{(async()=>{try{const l=await g.get(`/cart/${d}`);c(l.data.cart),p(l.data.cart)}catch(l){console.error("Error fetching cart items:",l)}finally{v(!1)}})()},[d]);const C=async a=>{a.preventDefault();try{const l=await g.post("/coupon/apply",{couponCode:r});l.data.success?t(l.data.discount):A.error(l.data.message)}catch(l){console.error("Error applying coupon:",l)}};o.useEffect(()=>{if(x!=null){const a=parseFloat(x);if(isNaN(a))console.log("Invalid discount value:",x);else{const u=i.reduce((D,I)=>D+I.price*I.quantity,0)*a/100;j(u)}}else j(0)},[x]);const b=i.reduce((a,l)=>a+l.price*l.quantity,0)-m,w=(b*.02).toFixed(2),N=15,s=(parseFloat(b.toString())+parseFloat(w)+parseFloat(N.toString())).toFixed(2);return e.jsxs("div",{className:"px-4 pt-8 relative ",children:[e.jsx("p",{className:"text-xl font-medium",children:"Order Summary "}),e.jsx("p",{className:"text-gray-400",children:"Check your items. And select a suitable shipping method."}),e.jsx("div",{className:"mt-8 space-y-3 max-h-[220px]  overflow-auto   rounded-lg border bg-white px-2 py-4 sm:px-6 custom-scrollbar",children:y?e.jsx("p",{children:"Loading..."}):i.map(a=>{var l;return e.jsxs("div",{className:"flex flex-col rounded-lg bg-white sm:flex-row",children:[e.jsx("img",{className:"m-2 h-24 w-28 rounded-md border object-cover object-center",src:`http://localhost:5000/${(l=a.productImage[0])==null?void 0:l.replace(/ /g,"%20")}`,alt:a.name}),e.jsxs("div",{className:"flex w-full flex-col px-4 py-4",children:[e.jsx("span",{className:"font-semibold",children:a.productName}),e.jsxs("span",{className:"float-right text-gray-400",children:["Qua: ",a.quantity," "]}),e.jsxs("p",{className:"text-lg font-bold",children:["₹",a.price.toFixed(2)]})]})]},a._id)})}),e.jsxs("form",{onSubmit:C,className:"py-5",children:[e.jsx("label",{htmlFor:"promo",className:"font-semibold inline-block mb-3 text-sm uppercase",children:"Coupon Code"}),e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",id:"promo",value:r,onChange:a=>f(a.target.value),placeholder:"Enter your code",className:"p-2 text-sm border-2  w-full"}),e.jsx("button",{type:"submit",className:"bg-red-500 hover:bg-red-600 px-5 py-2 text-sm text-white uppercase",children:"Apply"})]})]}),e.jsxs("div",{className:"w-full  flex flex-col items-end ",children:[x&&e.jsx("div",{className:"w-[200px] flex   ",children:e.jsxs("div",{className:"flex font-semibold w-full justify-between  gap-3 text-sm uppercase",children:[e.jsx("span",{children:"discount"}),e.jsx("div",{className:"flex w-1/3 justify-start ",children:e.jsxs("span",{children:["₹",m,"-"]})})]})}),e.jsx("div",{className:"w-[200px] flex   ",children:e.jsxs("div",{className:"flex font-semibold w-full justify-between  gap-3 text-sm uppercase",children:[e.jsx("span",{children:"Delivery"}),e.jsx("div",{className:"flex w-1/3 justify-start ",children:e.jsxs("span",{children:["₹",N,"+"]})})]})}),e.jsx("div",{className:"w-[200px] flex   ",children:e.jsxs("div",{className:"flex font-semibold w-full justify-between gap-3 text-sm uppercase",children:[e.jsx("span",{children:"Tax"}),e.jsx("div",{className:"flex w-1/3 justify-start ",children:e.jsxs("span",{children:["₹",w,"+"]})})]})})]}),e.jsx("div",{className:"border-t mt-3",children:e.jsxs("div",{className:"flex font-semibold justify-between py-6 text-sm uppercase",children:[e.jsx("span",{children:"Total cost"}),e.jsxs("span",{children:["₹",s]})]})}),e.jsx("button",{onClick:()=>h(s,m,r),className:"   bottom-0  w-full rounded-md bg-gray-900 px-6 py-3 font-medium text-white",children:"Place Order"})]})},B=()=>{const[p,h]=o.useState([]);o.useEffect(()=>{(async()=>{try{const r=await g.get("/coupon/get");console.log(r.data.data),h(r.data.data)}catch(r){console.error(r)}})()},[]);const n=c=>{navigator.clipboard.writeText(c),console.log("Coupon code copied to clipboard:",c)},[d,i]=o.useState(-1);return e.jsx("div",{children:p.length>0&&p.map((c,r)=>e.jsx("div",{className:"container mx-auto   ",children:e.jsxs("div",{className:"bg-gradient-to-br mb-5 from-purple-600 to-indigo-600 text-white text-center py-7 px-20 rounded-lg shadow-md relative",children:[e.jsxs("h3",{className:"text-xl font-semibold mb-4",children:[c.discount,"%   ",c.couponName]}),e.jsxs("div",{className:"flex items-center space-x-2 mb-6",children:[e.jsx("span",{id:"cpnCode",className:"border-dashed border text-white px-4 py-2 rounded-l ",children:c.couponCode}),e.jsx("span",{id:"cpnBtn",className:`  w-40  px-4 py-2 rounded-r cursor-pointer ${d===r?"bg-black":"bg-white  text-purple-600 border-white border "}  `,onClick:()=>{n(c.couponCode),i(r),setTimeout(()=>i(-1),1500)},children:d===r?"Copied":"Copy Code"})]}),e.jsxs("p",{className:"text-sm",children:["Valid Till: ",c.formattedDateTime]}),e.jsx("div",{className:"w-12 h-12 bg-white rounded-full absolute top-1/2 transform -translate-y-1/2 left-0 -ml-6"}),e.jsx("div",{className:"w-12 h-12 bg-white rounded-full absolute top-1/2 transform -translate-y-1/2 right-0 -mr-6"})]})},r))})},q=()=>{const p=T(),{user:h}=E(s=>s.userReducer),n=h._id,[d,i]=o.useState(!1),[c,r]=o.useState(!1),[f,x]=o.useState(!1),[t,m]=o.useState(),[j,y]=o.useState();o.useEffect(()=>{n&&g.get(`/user/${n}/addresses`).then(s=>{m(s==null?void 0:s.data[0])}).catch(s=>{console.error(s)})},[n]);const v=()=>{n&&g.get(`/user/${n}/addresses`).then(s=>{m(s.data[0])}).catch(s=>{console.error(s)})};console.log(t);const C=s=>{m(s)},b=s=>{m(s)},w=s=>{y(s)},N=async(s,a,l)=>{if(console.log("total",s),!n||!j||!t){A.error("Please fill in all required fields.");return}try{const u={userId:n,products:j,address:t,discountAmount:a,couponCode:l,totalPrice:s};console.log("checkoutData",u),p("/payment",{state:{checkoutData:u}})}catch(u){A.error("Failed to place order. Please try again later."),console.error("Error placing order:",u)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col items-center border-b bg-white py-4 sm:flex-row sm:px-10 lg:px-20 xl:px-32",children:[e.jsx("a",{href:"#",className:"text-2xl font-bold text-gray-800",children:"checkout"}),e.jsx("div",{className:"mt-4 py-2 text-xs sm:mt-0 sm:ml-auto sm:text-base",children:e.jsx("div",{className:"relative",children:e.jsxs("ul",{className:"relative flex w-full items-center justify-between space-x-2 sm:space-x-4",children:[e.jsxs("li",{className:"flex items-center space-x-3 text-left sm:space-x-4",children:[e.jsx("a",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-emerald-200 text-xs font-semibold text-emerald-700",href:"#",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})})}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Shop"})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})}),e.jsxs("li",{className:"flex items-center space-x-3 text-left sm:space-x-4",children:[e.jsx("a",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-gray-600 text-xs font-semibold text-white ring ring-gray-600 ring-offset-2",href:"#",children:"2"}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Shipping"})]}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 5l7 7-7 7"})}),e.jsxs("li",{className:"flex items-center space-x-3 text-left sm:space-x-4",children:[e.jsx("a",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-gray-400 text-xs font-semibold text-white",href:"#",children:"3"}),e.jsx("span",{className:"font-semibold text-gray-500",children:"Payment"})]})]})})})]}),e.jsxs("div",{className:"grid sm:px-10 lg:grid-cols-2 lg:px-20 xl:px-32",children:[e.jsxs("div",{className:"px-4 pt-5",children:[e.jsxs("div",{className:"flex justify-between  ",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t!=null?e.jsx(k,{icon:S,style:{color:"#63E6BE"}}):e.jsx(k,{icon:S,beat:!0,style:{color:"#63E6BE"}}),e.jsx("p",{className:"text-xl font-medium",children:"Address"})]}),e.jsxs("div",{className:"mt-4 mr-2 ",children:[e.jsx("button",{onClick:()=>{i(!d)},className:"bg-indigo-500 font-semibold hover:bg-indigo-600 py-3 px-5 text-sm text-white uppercase w-full",children:"+ address"}),d?e.jsx("div",{className:"bg-black/80 fixed w-full h-screen z-10 top-0 left-0"}):"",d&&e.jsx(F,{userId:n,setAddress:v,onClose:()=>{i(!1)}})]})]}),e.jsx("p",{className:"text-gray-400",children:"select your address or add a new address."}),e.jsx("div",{className:"mt-8 space-y-3 rounded-lg border bg-white px-2 py-4 sm:px-6",children:t!==void 0?e.jsxs("div",{className:"flex justify-between   ",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 ",children:[e.jsx(k,{icon:S}),e.jsx("h3",{className:"text-[#093bc9] font-semibold ",children:t==null?void 0:t.city})]}),e.jsxs("div",{className:"w-[300px]",children:[e.jsx("p",{children:t==null?void 0:t.street}),e.jsx("p",{children:`${t==null?void 0:t.state} - ${t==null?void 0:t.zipCode} `})]}),e.jsx("button",{onClick:()=>{r(!d)},className:"text-[#094fc9] font-normal mt-3",children:"Edit address"}),c?e.jsx("div",{className:"bg-black/80 fixed w-full h-screen z-10 top-0 left-0"}):"",c&&e.jsx(P,{userId:n,currentAddress:t,onhandleUpdateAddress:C,onClose:()=>{r(!1)}})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{x(!f)},className:"text-[#093bc9] font-medium",children:"Choose another address"})}),f?e.jsx("div",{className:"bg-black/80 fixed w-full h-screen z-10 top-0 left-0"}):"",f&&e.jsx(O,{onClose:()=>{x(!1)},onAddressSelect:b})]}):e.jsx("p",{className:"text-red-500",children:"add a new address"})}),e.jsx("div",{className:"mt-8 space-y-3 max-h-[250px] overflow-auto rounded-lg border bg-white px-2 py-4 sm:px-6 custom-scrollbar",children:e.jsx(B,{})})]}),e.jsx($,{onPlaceOrder:N,orderCartItem:w})]})]})};export{q as default};
