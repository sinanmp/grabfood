import{p as O,r as o,a as A,l as i,_ as c,j as e,A as R,q as U}from"./index-YJK9wbQ5.js";const k="http://localhost:5000",B=()=>{const{id:l}=O(),[a,d]=o.useState({}),[g,p]=o.useState([]),[v,b]=o.useState(!0),[h,u]=o.useState(null),[x,f]=o.useState(!1),[j,y]=o.useState(!1),[N,I]=o.useState(0),[w,E]=o.useState([]),S=A();o.useEffect(()=>{try{i.get("/category/get").then(r=>{r.data.success&&E(r.data.data)})}catch(r){c.error("Error while loading categories"),console.error(r)}},[]),o.useEffect(()=>{(async()=>{try{const t=await i.get(`/product/${l}`);t.data.success?d(t.data.data):u(t.data.message||"Failed to fetch product details")}catch{u("Error fetching product details")}finally{b(!1)}})()},[l]),console.log(a);const C=r=>{const t=r.target.files;t&&t.length>0&&p(s=>[...s,...Array.from(t)])},F=r=>{p(t=>{const s=[...t];return s.splice(r,1),s})},P=async r=>{try{const t=[...a.productImage],s=t.splice(r,1)[0];d(m=>({...m,productImage:t}));const n=await i.delete(`/product/deleteImage/${l}`,{data:{imageName:s}});n.data.success?c.success("Image deleted successfully!"):(c.error(n.data.message||"Failed to delete image"),d(m=>({...m,productImage:[...t,s]})))}catch(t){console.error("Error deleting image",t),c.error("Failed to delete image")}},$=async r=>{r.preventDefault();try{f(!0);const t=new FormData;t.append("name",a.productName),t.append("price",String(a.price)),t.append("category",a.category),t.append("offer",String(N)),a.productImage.forEach(n=>{t.append("images",n)}),g.forEach(n=>{t.append("images",n)});const s=await i.put(`/product/update/${l}`,t);console.log(s),s.data.success?(d(s.data.data.updatedProduct),c.success(s.data.message)):c.error(s.data.message||"Failed to update Product")}catch(t){c.error(t.response.data.message)}finally{f(!1)}},L=async()=>{try{(await i.delete(`/product/delete/${l}`)).status===200?(c.success("Product deleted successfully"),S("/admin/product")):(console.error("Error deleting product"),u("Failed to delete product"),c.error("Failed to delete product"))}catch(r){console.error("Error deleting product",r),u("Failed to delete product"),c.error("Failed to delete product")}};return v?e.jsx("div",{children:"Loading..."}):h?e.jsxs("div",{children:["Error: ",h]}):e.jsxs("div",{className:"admin-container",children:[e.jsx(R,{}),e.jsxs("main",{className:"product-management",children:[e.jsxs("section",{children:[e.jsxs("strong",{children:["ID - ",a==null?void 0:a._id]}),(a==null?void 0:a.productImage)&&a.productImage.length>0&&e.jsx("div",{className:" w-full form-group",children:e.jsx("div",{className:" w-full grid grid-cols-3 border-2  rounded-xl shadow p-3 gap-4 mt-1",children:a.productImage.map((r,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:`${k}/${r}`,alt:`Existing ${t}`,className:"w-full h-32 object-cover rounded-md"}),e.jsx("button",{type:"button",className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-all duration-300",onClick:()=>P(t),children:"X"})]},t))})}),g.length>0&&e.jsx("div",{className:"form-group",children:e.jsx("div",{className:"grid grid-cols-3 gap-4 mt-1",children:g.map((r,t)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:URL.createObjectURL(r),alt:`Preview ${t}`,className:"w-full h-32 object-cover rounded-md"}),e.jsx("button",{type:"button",className:"absolute top-0 right-0 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-all duration-300",onClick:()=>F(t),children:"X"})]},t))})}),e.jsx("p",{children:a==null?void 0:a.productName}),e.jsxs("h3",{children:["â‚¹",a==null?void 0:a.price]})]}),e.jsxs("article",{children:[e.jsx("button",{className:"product-delete-btn",onClick:L,disabled:x,children:e.jsx(U,{})}),e.jsxs("form",{onSubmit:$,children:[e.jsx("h2",{children:"Manage"}),e.jsxs("div",{children:[e.jsx("label",{children:"Name"}),e.jsx("input",{type:"text",value:a==null?void 0:a.productName,onChange:r=>d({...a,productName:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Price"}),e.jsx("input",{type:"number",value:a==null?void 0:a.price,onChange:r=>d({...a,price:r.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Category"}),e.jsxs("select",{name:"category",id:"category",value:a==null?void 0:a.category,onChange:r=>d({...a,category:r.target.value}),className:"min-w-[180px] w-[20vw] border border-teal-700 rounded-xl p-2 text-sm",children:[e.jsx("option",{value:"",children:a==null?void 0:a.category}),w.map((r,t)=>e.jsx("option",{value:r.category,children:r.category},t))]})]}),e.jsxs("div",{className:"flex w-full ",children:[e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>{y(!j)},className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Add Offer"})}),j&&e.jsx("div",{children:e.jsx("input",{onChange:r=>I(parseInt(r.target.value,10)),className:"w-52",placeholder:"Offen in percentage..",type:"number"})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Photo"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"imageInput",className:"cursor-pointer bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-all duration-300",children:"Upload Images"}),e.jsx("input",{type:"file",id:"imageInput",accept:"image/*",multiple:!0,className:"hidden",onChange:C})]})]}),e.jsx("button",{type:"submit",disabled:x,children:"Update"})]})]})]})]})};export{B as default};
